"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var contract_addresses_1 = require("@0x/contract-addresses");
var subproviders_1 = require("@0x/subproviders");
var _ = require("lodash");
var order_watcher_web_socket_server_1 = require("./order_watcher/order_watcher_web_socket_server");
var GANACHE_NETWORK_ID = 50;
var DEFAULT_RPC_URL = 'http://localhost:8545';
var provider = new subproviders_1.Web3ProviderEngine();
var jsonRpcUrl = process.env.JSON_RPC_URL || DEFAULT_RPC_URL;
var rpcSubprovider = new subproviders_1.RPCSubprovider(jsonRpcUrl);
provider.addProvider(rpcSubprovider);
provider.start();
var networkId = process.env.NETWORK_ID !== undefined ? _.parseInt(process.env.NETWORK_ID) : GANACHE_NETWORK_ID;
var contractAddressesString = process.env.contractAddresses;
var contractAddressesIfExists = contractAddressesString === undefined
    ? contract_addresses_1.getContractAddressesForNetworkOrThrow(networkId)
    : JSON.parse(contractAddressesString);
var orderWatcherConfig = {
    isVerbose: process.env.IS_VERBOSE === 'true',
};
var orderExpirationCheckingIntervalMs = process.env.ORDER_EXPIRATION_CHECKING_INTERVAL_MS;
if (orderExpirationCheckingIntervalMs !== undefined) {
    orderWatcherConfig.orderExpirationCheckingIntervalMs = _.parseInt(orderExpirationCheckingIntervalMs);
}
var eventPollingIntervalMs = process.env.EVENT_POLLING_INTERVAL_MS;
if (eventPollingIntervalMs !== undefined) {
    orderWatcherConfig.eventPollingIntervalMs = _.parseInt(eventPollingIntervalMs);
}
var expirationMarginMs = process.env.EXPIRATION_MARGIN_MS;
if (expirationMarginMs !== undefined) {
    orderWatcherConfig.expirationMarginMs = _.parseInt(expirationMarginMs);
}
var cleanupJobIntervalMs = process.env.CLEANUP_JOB_INTERVAL_MS;
if (cleanupJobIntervalMs !== undefined) {
    orderWatcherConfig.cleanupJobIntervalMs = _.parseInt(cleanupJobIntervalMs);
}
var wsServer = new order_watcher_web_socket_server_1.OrderWatcherWebSocketServer(provider, networkId, contractAddressesIfExists, orderWatcherConfig);
wsServer.start();
//# sourceMappingURL=server.js.map